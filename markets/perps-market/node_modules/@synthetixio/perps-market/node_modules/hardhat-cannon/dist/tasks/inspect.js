"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const builder_1 = require("@usecannon/builder");
const cli_1 = require("@usecannon/cli");
const chalk_1 = require("chalk");
const config_1 = require("hardhat/config");
const task_names_1 = require("../task-names");
(0, config_1.task)(task_names_1.TASK_INSPECT, 'Inspect the details of a Cannon package')
    .addOptionalPositionalParam('packageName', 'Name and version of the cannon package to inspect')
    .addOptionalParam('chainId', 'Chain ID of the variant to inspect')
    .addOptionalParam('preset', 'Preset of the variant to inspect')
    .addOptionalParam('writeDeployments', 'Path to write the deployments data (address and ABIs), like "./deployments"')
    .addOptionalParam('sources', 'Show contract sources')
    .addFlag('json', 'Output as JSON')
    .setAction(async ({ packageName, json, writeDeployments, chainId, preset: presetArg, sources }, hre) => {
    const packageSpec = await hre.run(task_names_1.SUBTASK_LOAD_PACKAGE_DEFINITION, {
        packageWithSettingsParams: packageName ? [packageName] : [],
    });
    const cliSettings = (0, cli_1.resolveCliSettings)();
    if (!chainId) {
        chainId = hre?.network?.config?.chainId || 13370;
    }
    const packageRef = packageSpec.preset
        ? `${packageSpec.name}:${packageSpec.version}@${packageSpec.preset}`
        : `${packageSpec.name}:${packageSpec.version}`;
    let { preset } = new builder_1.PackageReference(packageRef);
    // Handle deprecated preset specification
    if (presetArg) {
        console.warn((0, chalk_1.yellow)((0, chalk_1.bold)('The --preset option will be deprecated soon. Reference presets in the package reference using the format name:version@preset')));
    }
    preset = presetArg || packageSpec.preset;
    await (0, cli_1.inspect)(packageRef, cliSettings, chainId, preset, json, writeDeployments, sources);
});
//# sourceMappingURL=inspect.js.map